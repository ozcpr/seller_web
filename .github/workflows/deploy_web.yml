name: WebServerDeployment
on:
  push:
    branches:
      - main
      
jobs:
  build_web:
    environment: WebServerDeploy
    name: Build Flutter (Web)
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - uses: subosito/flutter-action@v2.10.0
      with:
          flutter-version: '3.7.10'
          channel: 'stable'
    - run: flutter config --enable-web
    - run: flutter create .
    - run: flutter build web --web-renderer html --dart-define=API_URL=$API_URL --dart-define=USERNAME=$USERNAME --dart-define=PASSWORD=$PASSWORD --dart-define=API_URL_CONTENT=$API_URL_CONTENT
      env:
        API_URL: "https://test.satta.biz/api/v1/login.json"
        USERNAME: "sattadestek10@satta.biz"
        PASSWORD: "deneme123"
        API_URL_CONTENT: "https://test.satta.biz/api/v1/current_user_info.json"
    - uses: easingthemes/ssh-deploy@v4.1.8
      env:
        SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
        SOURCE: "build/web/"
        REMOTE_HOST: ${{ secrets.REMOTE_HOST }}
        REMOTE_USER: ${{ secrets.REMOTE_USER }}
        TARGET: "/var/www/html/paletpoint/"
